---
output: hugodown::md_document
# Documentation: https://sourcethemes.com/academic/docs/managing-content/

title: "Session 1: Backyard Birds"
subtitle: "Starting with RStudio Projects and reading in our data"
summary: ""
authors: [admin]
tags: [codeclub, backyard-birds]
categories: []
date: 2020-11-04
lastmod: 2020-11-04
featured: false
draft: false

toc: true

# Featured image
# To use, add an image named `featured.jpg/png` to your page's folder.
# Focal points: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight.
image:
  caption: "Red-breasted Nuthatch, *Sitta canadensis*"
  focal_point: ""
  preview_only: false

# Projects (optional).
#   Associate this post with one or more of your projects.
#   Simply enter your project's folder or file name without extension.
#   E.g. `projects = ["internal-project"]` references `content/project/deep-learning/index.md`.
#   Otherwise, set `projects = []`.
projects: []
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=FALSE)
```

----

<br>

## Prep homework {#prep}


#### Basic computer setup

If you didn't already do this, please follow the [Code Club Computer Setup](/codeclub-setup/) instructions.


#### Test if it works

Please open RStudio locally or [start an OSC RStudio Server session](/codeclub-setup/#osc-run-rstudio).

If you have not used RStudio before, take a moment to explore what's in the panels and tabs.
(It may help to check out [Mike Sovic's 1-minute intro to the RStudio interface](https://www.youtube.com/watch?v=ByxF3xjN2JQ&list=PLxhIMi78eQegFm3XqsylVa-Lm7nfiUshe&t=2m15s) 
or [RStudio's 3-minute intro](https://fast.wistia.net/embed/iframe/520zbd3tij?videoFoam=true).)

If you're able to do so, please open RStudio again a bit before Code Club starts --
and in case you run into issues,
please join the Zoom call early and we'll troubleshoot.

#### New to R?

If you're completely new to R,
it will be useful to have a look at some of the resources listed on our
[New to R?](/codeclub-novice/) page prior to Code Club.

<br>

-----

## Session summary

- Introducing Code Club

- Making sure everyone has a working RStudio session

- RStudio Projects

- If we have time: Getting started with data from the Great Backyard Bird Count

<br>

----

----

## Create an RStudio Project

Projects are an RStudio-specific concept that create a special file (`.Rproj`),
primarily to designate a directory as the working directory for everything within it.
We recommend creating exactly one separate Project for each research project
with an R component -- 
and for things like Code Club.

<br>
<div class="alert alert-note">
<div>

**Why use Projects?**

In brief, Projects help you to organize your work and to make it more portable.

- They record which scripts (and R Markdown files) are open in RStudio,
  and will reopen all of those when you reopen the project.
  This becomes quite handy, say, when you work on three different projects,
  each of which uses a number of scripts.

- When using Projects, you generally don't have to manually set your working directory,
  and can use *relative file paths* to refer to files within the project.
  This way, even if you move the project directory,
  or copy it to a different computer,
  the same paths will still work.
  (This would not be the case if you used `setwd()` which will generally require
  you to use an absolute path, e.g. `setwd('C:/Users/Jane/Documents/')`.)

- Projects encourage you to organize research projects inside self-contained directories,
  rather than with files spread around your computer.
  This can save you a lot of headaches and increases reproducibility.
</div>
</div>

<br>

**Let's create an RStudio Project for Code Club:**

- Open RStudio locally or [start an OSC RStudio Server session](/codeclub-setup/#osc-run-rstudio).

- *If you're working locally*, create a directory wherever you like on your computer
  for all things Code Club.
  You can do this in R using `dir.create()`, or outside of R.   
  (*If you're at OSC*, skip this step because you're automatically inside
  a Code Club-specific, personal directory.)

- Click `File` (top menu bar) > `New Project`, and then select `Existing Directory`.
  
  - *If you're working locally*, select the Code Club directory that you created in the previous step.
  
  - *If you're working at OSC*, keep the default choice "`~`" (i.e., *home*),
    which is the directory you started in when entering the RStudio Server session.

- You should now see the file ending in `.Rproj` in the RStudio `Files` tab in the lower right pane.

(To open an existing Project, use `File` > `Open Project` inside RStudio,
or click the `.Rproj` file in your file browser.)

<br>

----

## Orienting ourselves

#### Where are we?

Type in the console (bottom left):

```{r}
getwd()    # short for "get working directory"
```

When a Project is open,
the R working directory will always be the directory that contains the `.Rproj` file.

#### Create directories

Create two new directories -- one for this session,
and one for a dataset that we will download shortly
(and will be reusing across sessions):

```{r}
# Dir for Code Club Session 1:
dir.create('S01')

# Dir for our bird data:
dir.create('data/birds/', recursive = TRUE) # The "recursive" argument lets us
                                            # create two levels at once
```

#### Create a script

To keep a record of what we are doing, and to easily modify and rerun earlier commands,
we'll want to save our commands in a script and execute them from there,
rather than typing our commands directly in the console.

- Click `File` (top menu bar) > `New File` > `R script`.   

- Save the script (`File` > `Save`) as `S01.R` inside your `S01` directory.

#### First line of the script

Type the following command on the first line of the script:
```{r}
library(tidyverse)
```

Now we have loaded the core set of 8 *tidyverse* packages all at once.
(`library()` is the standard function to load packages and usually loads just
a single package.)

<div class="alert alert-note">
<div>
The *tidyverse* is a very popular ecosystem of R packages
for data analysis, which we will be using a lot in Code Club.
  
It can be characterized as a dialect of R,
and as such can sometimes cause confusion.
Its rapid development in the past few years has also meant that in some cases,
a function you learned is no longer recommended or --more rarely-- supported
a year or so later.
Such big changes should become less common now that the ecosystem has matured
a fair bit.
  
Overall, we think the *tidyverse* is well worth learning and using.

</div>
</div>

#### Run the line

Execute the line, i.e. to send it to the console:
press `Ctrl Enter`.

<br>

----

## Getting a bird dataset

We downloaded a Great Backyard Bird Count (GBBC) [dataset](https://www.gbif.org/dataset/82cb293c-f762-11e1-a439-00145eb45e9a)
from the [Global Biodiversity Information Facility (GBIF)](https://www.gbif.org/).
Because the file was 3.1 GB large, I selected only the records from Ohio
and removed some uninformative columns.
I have put the resulting 36 MB file in our Github repo from which we'll download it now.

<div class="alert alert-note">
<div>

### The Great Backyard Bird Count

```{r gbbc-pic, eval=TRUE, echo=FALSE, results='show', out.width="90%", fig.align = 'center'}
knitr::include_graphics('GBBC_screenshot.png')
```

<br>

The [GBBC](https://gbbc.birdcount.org/) is an annual
citizen science event where everyone is encouraged to to identify
and count birds in their backyard -- or anywhere else -- for at least 15 minutes,
and report their sightings online.
Since 2013, it is a global event, but it has been done since 1998 in the US and Canada.

</div>
</div>

#### Download the data

We can download the dataset using the `download.file()` function:
```{r, eval=FALSE}
birds_file_url <- 'https://raw.githubusercontent.com/biodash/biodash.github.io/master/data/birds/backyard-birds_Ohio.tsv'
birds_file <- 'data/birds/backyard-birds_Ohio.tsv'
download.file(url = birds_file_url, destfile = birds_file)
```

#### Read the data

Now, let's read the file into R.
The `.tsv` extension ("tab-separated values") tells us this is a plain text
file in which columns are separated by tabs,
so we will use a convenience function from the *readr* package 
(which is part of the core set of 8 *tidyverse* packages, so it is already loaded)
for exactly this type of file:

```{r, eval=FALSE}
birds <- read_tsv(birds_file)
```

Done! We have now read our data into a *tibble*, which is a type of data frame
(formally a *data.frame*): R's object type to deals with tabular data wherein each
column can contain a different type of data (numeric, characters/strings, etc).

<br>

----

## Exploring backyard birds

To get a feel for our data, we can run the following commands:

```{r}
birds          # Simply typing the name of an object will print it to screen
print(birds)   # Same as above, but explicitly calling print()    

str(birds)     # Short for "structure", for column-wise information 
glimpse(birds) # tidyverse version of str()

View(birds)    # In RStudio, will open object in a table in an Rstudio tab.
               # Clicking on the object in the `Environment` pane will do the same!
```

:::puzzle

### Exercise 1

**What's in the dataset?**

- Explore the output of the commands above, and try to understand what you see.
  What does a single row represent, and what is in each column?

- In particular, pay attention to the data types (e.g., "character" or `chr`)
  of the different columns, which several of these functions print.
  The output of our `read_csv()` command also printed this information --
  this function parsed our column into the types we see now.
  Were all the columns parsed correctly? 

- How many rows and how many columns does the dataset have?

- What are some simple questions you would like to answer using this dataset?
  We'll collect some of these and try to answer them in later sessions.

<details>
  <summary>
  Hints (click here)
  </summary>
<br>

- Note that in R, `dbl` (for "double") and `num` (for "numeric") are both used,
  and almost interchangeably so, for floating point numbers.
  (Integers are a separate class that are simply called "integers" and
  abbreviated as `int`,
  but we have no integer columns in this dataset.)

- `read_tsv()` parsed our date as a "date-time" (`dttm` or `POSIXct` for short),
  which contains both a date and a time (this is not a common format for most R users).
  In our case, it looks like the time is always "00:00:00" and thus
  doesn't provide any information.

</details>

<br>

<details>
  <summary>
  Solutions (click here)
  </summary>
<br>

```{r}
# Just printing the glimpse() output to show the number of rows and columns:
glimpse(birds)

## Rows: 311,441
## Columns: 10
## $ class            <chr> "Aves", "Aves", "Aves", "Aves", "Aves", "Aves", "Aves", "Aves", "Aves", "Aves", "Aves", "Aves", "Aves…
## $ order            <chr> "Passeriformes", "Passeriformes", "Passeriformes", "Passeriformes", "Passeriformes", "Passeriformes",…
## $ family           <chr> "Corvidae", "Corvidae", "Corvidae", "Corvidae", "Corvidae", "Corvidae", "Corvidae", "Corvidae", "Corv…
## $ genus            <chr> "Cyanocitta", "Cyanocitta", "Cyanocitta", "Cyanocitta", "Cyanocitta", "Cyanocitta", "Cyanocitta", "Cy…
## $ species          <chr> "Cyanocitta cristata", "Cyanocitta cristata", "Cyanocitta cristata", "Cyanocitta cristata", "Cyanocit…
## $ locality         <chr> "44805 Ashland", "45244 Cincinnati", "44132 Euclid", "45242 Cincinnati", "45246 Cincinnati", "44484 W…
## $ stateProvince    <chr> "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio", "Ohio…
## $ decimalLatitude  <dbl> 40.86166, 39.10666, 41.60768, 39.24236, 39.28207, 41.23180, 41.38730, 41.31395, 41.70916, 39.96116, 3…
## $ decimalLongitude <dbl> -82.31558, -84.32972, -81.50085, -84.35545, -84.46880, -80.75410, -81.31230, -81.68515, -83.70952, -8…
## $ eventDate        <dttm> 2007-02-16, 2007-02-17, 2007-02-17, 2007-02-19, 2007-02-18, 2007-02-17, 2008-02-16, 2008-02-17, 2008…
```
- The dataset has 311,441 rows, and 10 columns.

</details>


:::


<br>
<br>

----

----

## Bonus material

<br>


<div class="alert alert-note">
<div>

### `readr` options for challenging files

Note that our function call worked without specifying any additional arguments,
i.e. with all the default options. It is not always this easy!

Some options for more complex cases:

- The more general counterpart of this function is `read_delim()`,
  which allows you to specify the delimiter using an argument using the `sep`
  argument, e.g. `sep="\t"` for tabs.

- There are also arguments to these functions for when you need to skip lines,
  when you don't have column headers, when you need to specify the column types
  of some or all the columns, and so forth -- see this example:  
  ```{r}
  my_df <- read_delim(
    'file.txt',
    col_names = FALSE,        # Don't consider the first line to be a header
    skip = 3,                 # Skip the first three lines of the file
    comment = "#",            # Skip any line beginning iwth a "#"
    col_types = cols(         # Specify column types
      col1 = col_character(), # ..Note that we only need to specify columns 
      col2 = col_double()     # ..for which we need non-automatic typing
      )
    )
  ```

- It is also possible to read Excel files directly using functions from
  the *readxl* package.
  
</div>
</div>

<br>

<div class="alert alert-note">
<div>

### Other options for reading data

There are also functions in "base R" (i.e., they are loaded into R by default,
and not part of the *tidyverse*) that read tabular data,
such as `read.table()` and `read.delim()`.

These are generally slower than the *readr* functions,
and have less sensible default options to their arguments.
Particularly relevant is how columns with characters (strings) are parsed --
until R 4.0, which was released earlier this year,
base R's default behavior was to parse them as **factors**,
which is generally not desirable^[You can check which version of R you are running by typing `sessionInfo()`.
You can also check directly how strings are read by default
with `default.stringsAsFactors()`.
To avoid conversion to factors, specify `stringsAsFactors = FALSE` in your
`read.table()` / `read.delim()` function call.].
*readr* functions will never convert columns with strings to factors.

If speed is important, which it becomes when reading in very large files
(~ 100s of MBs or larger), you should consider using the `fread()` function
from the *data.table* package.

</div>
</div>

<br>

<div class="alert alert-note">
<div>

### Types of data frames

When you use base R functions to read in data, you will get a `data.frame` object.
However, when you use *readr*, you will get the *tidyverse*'s **subclass** of `data.frame`:
colloquially called a `tibble` and formally a `tbl_df`.

`tibbles` and "regular" `data.frames` can generally be used interchangeably,
but some default behavior does differ.
Most strikingly, they are printed to screen differently.

To tell what kind of data frame your are dealing with,
and to tell the class of any R object,
use the `class()` function, e.g. `class(birds)`.

</div>
</div>

:::puzzle

### Exercise 2 (optional/homework)

**Comparing _tibbles_ and regular _data.frames_**

Read in the bird data as a *data.frame* and compare overviews of the
*tibble* and the *data.frame*.

- What are some differences in how they are displayed and behave?
  In particular, compare what happens when you use `print()`
  (or simply type the object name).

- Were all the columns parsed in the same way -- i.e., did the *tibble* and the
  *data.frame* assign the same class to each column?

- How could you switch (convert) directly between *tibble* and *data.frame* objects? 

<details>
  <summary>
  Hints (click here)
  </summary>
<br>
<ul>
<li>Use the <code>read.table()</code> function,
    and note that you will need to specify non-default options for the arguments <code>sep</code> and      <code>header</code>. Type <code>?read.table</code> for details.</li>
<li>Have a close look at the class for the "eventDate" column.
    Note that <code>POSIXct</code> is the formal date-time class,
    while tibbles/tidyverse will refer to these as <code>ddtm</code>.</li>
<li>Use the <code>as.data.frame()</code> and <code>as_tibble()</code> functions to change the object type.
</li>
</ul>

</details>

<br>

<details>
  <summary>
  Solutions (click here)
  </summary>
<br>

```{r}
# Read the dataset as data.frame using read.table():
birds_df <- read.table(infile, sep = '\t', header = TRUE)

# Class of the eventDate column -- read.table() did not parse the date as a date!
class(birds$eventDate)
# [1] "POSIXct" "POSIXt" 
class(birds_df$eventDate)
# [1] "character"

# Convert between a data.frame and a tibble:
birds_df <- as.data.frame(birds)
birds_tibble <- as_tibble(birds_df)
```

</details>

:::

<br> <br> <br>

